class BtRecentlyViewedUtil{static init(){BtRecentlyViewedUtil.key="recently_viewed"}static setArray(array){BtStorageUtil.set(BtRecentlyViewedUtil.key,array)}static getArray(){return BtStorageUtil.get(BtRecentlyViewedUtil.key,!0)||[]}static addProduct(productId,productUrl,productImage,limit){let existProduct=BtRecentlyViewedUtil.getArray().filter(e=>e.product_id!=productId);existProduct.unshift({product_id:productId,url:productUrl,image:productImage}),existProduct.length>limit&&existProduct.pop(),BtRecentlyViewedUtil.setArray(existProduct)}}BtRecentlyViewedUtil.init();const recentlyViewedObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{entry.isIntersecting&&(entry.target.updateContent(),observer.unobserve(entry.target))})},{threshold:.1});class RecentlyViewed extends HTMLElement{constructor(){super(),this.limit=parseInt(this.dataset.limit),this.isEmpty=!0,this.updatedContent=!1,this.section=this.querySelector(".recently-viewed-products__section"),this.results=this.querySelector(".recently-viewed-products__results"),this.dataset.productId&&this.addProduct(this.dataset.productId,this.dataset.productUrl,this.dataset.productImage)}connectedCallback(){recentlyViewedObserver.observe(this)}addProduct(productId,productUrl,productImage){BtRecentlyViewedUtil.addProduct(productId,productUrl,productImage,this.limit),this.updatedContent=!1}updateContent(){const itemList=BtRecentlyViewedUtil.getArray();if(itemList.length>0){const newIds=[];itemList.forEach(item=>{newIds.push(`id:${item.product_id}`)});const idsQuery=newIds.join(" OR ");fetch(`${window.routes.search_url}?section_id=recently-viewed-products-ajax&q=${idsQuery}&type="product"`).then(response=>response.text()).then(response=>{const html=new DOMParser().parseFromString(response,"text/html");this.hasAssets||(html.querySelectorAll(".assets > *").forEach(asset=>{document.body.appendChild(asset)}),this.hasAssets=!0);const sliderComponent=html.querySelector("slider-component");if(sliderComponent){if(sliderComponent.setAttribute("data-outside-prev-button-id",this.dataset.prevButton),sliderComponent.setAttribute("data-outside-next-button-id",this.dataset.nextButton),this.dataset.fullWidth&&(sliderComponent.classList.add("page-width--full"),sliderComponent.classList.contains("has-slider"))){sliderComponent.classList.add("slider-component-full-width");const productGrid=sliderComponent.querySelector(".product-grid");productGrid.classList.contains("slider")&&productGrid.classList.add("grid--peek")}this.section.classList.remove("hidden"),this.results.innerHTML=="",this.results.appendChild(sliderComponent)}else this.section.classList.add("hidden")})}this.updatedContent=!0}}customElements.define("recently-viewed",RecentlyViewed);
//# sourceMappingURL=/cdn/shop/t/7/assets/recently-viewed.js.map?v=115594340638902621061715898701
